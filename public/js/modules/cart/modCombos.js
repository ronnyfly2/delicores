(function(){define(["priceCombo","libUnderscore","libFancyBox"],function(e){var o,i,a,r,s,b,t;b={ctnListCbo:".list-cboresumen",lnkAddCbo:".combo_resume .btn_add",lnkDeleteCbo:".lnkCboDelete",tplCombos:"#tplCombos",tplCombo:"#tplCombo",itemsCombos:".modal_combo .box_combo",ctnLoaderCombo:".combo_resume"};i={};s=listCombos;o=function(){i.ctnListCbo=$(b.ctnListCbo);i.lnkAddCbo=$(b.lnkAddCbo);i.tplCombos=_.template($(b.tplCombos).html().replace(/[\n\r]/g,""));i.tplCombo=_.template($(b.tplCombo).html());i.ctnLoaderCombo=$(i.ctnLoaderCombo)};t=function(){i.lnkAddCbo.on("click",a.openModal);i.ctnListCbo.on("click",b.lnkDeleteCbo,a.deleteCbo)};a={openModal:function(){var o,t;o=$(this);t=$(i.tplCombos({combos:s}));t.find(".btn-addcbo").on("click",a.addCbo);$.fancybox({content:$(".modal_combo").html(t),autoSize:true,autoResize:true,autoWidth:true,beforeShow:function(){utils.loader($(".box_resume"),true)},afterLoad:function(){e.init()},beforeClose:function(){utils.loader($(".box_resume"),false)},padding:0,autoScale:false,wrapCSS:"fancy_combo",transitionIn:"none",transitionOut:"none",title:this.title,width:"80%",height:"auto",helpers:{overlay:{closeClick:false,css:{"background-color":"rgba(255,255,255,0.9)"}}}})},addCbo:function(){var t,l,n,c;n=true;l="";c=[];$(b.itemsCombos+".add_border").each(function(){var o,t,e,a;o=$(this);e=o.data("id");t=$.trim(o.find(".cant_combo").val());t=t===""||t==="0"?1:t;a="||";if(n){a="";n=false}l=l+a+e+"-"+t;c.push(e)});if(l!==""){t=$(".modal_combo");utils.loader(t,true);$(".btn-addcbo").attr("disabled",true);return $.ajax({url:window.alpha.baseUrl+"webservice/cart/add-combo",data:{dataCombo:l},before:function(){return utils.loader(t,true)},success:function(o){if(parseFloat(o.status)===1){utils.loader(t,false);s=o.data;r.addCombos(l);$.fancybox.close();r.calculatePrice();r.calculateTotalPrices()}}})}},deleteCbo:function(){var o,t,e,a;o=$(this);a=o.parents(".box_item_combo_resume");e=o.parents(".cant");t=e.data("id");utils.loader(a,true);$.ajax({url:window.alpha.baseUrl+"webservice/cart/delete-combo",data:{id:t},success:function(o){utils.loader(a,false);if(parseFloat(o.status)===1){s=o.data;a.remove();r.manageDisplayCbo();r.calculatePrice();r.calculateTotalPrices()}}})}};r={calculatePrice:function(){var l,n,c;n=0;l=0;c=0;[].forEach.call($(".box_item_combo_resume"),function(o,t,e){var a;a=$(o);n=parseFloat(a.find(".combo_item").data("price"));l=parseInt(a.find(".cant").data("cant"),10)||0;return c+=n*l});$(".sb_total").text(c.toFixed(2))},calculateTotalPrices:function(){var o,l,n;l=0;o=0;n=0;[].forEach.call($(".sb_total_price"),function(o,t,e){var a;a=$(o);l=parseFloat(a.text());return n+=l});$(".total_prices").text(n.toFixed(2))},manageDisplayCbo:function(){var o,t;o=i.ctnListCbo.find("li").length;t=s.combos.length;if(o>=t){i.lnkAddCbo.fadeOut()}else{i.lnkAddCbo.fadeIn()}},addCombos:function(o){var t,c;t=o.split("||");c=_.clone(s.combos);c=_.indexBy(c,"id");_.each(t,function(o){var t,e,a,l,n;t=o.split("-");l=t[0];e=t[1];n={combo:c[l],cantidad:e};a=i.tplCombo(n);i.ctnListCbo.append(a)});r.manageDisplayCbo()}};o();t();r.manageDisplayCbo();r.calculateTotalPrices()})}).call(this);